# App Folder Documentation - Complete Guide

**Project**: Kimia TCG (GitHub Version)  
**Framework**: Next.js 14+ (App Router)  
**Last Updated**: January 1, 2026

---

## ğŸ“‹ Table of Contents
1. [Overview](#overview)
2. [Folder Structure](#folder-structure)
3. [Routing Architecture](#routing-architecture)
4. [File-by-File Documentation](#file-by-file-documentation)
5. [Critical Files to Preserve](#critical-files-to-preserve)
6. [Future Development Guidelines](#future-development-guidelines)

---

## ğŸ¯ Overview

The `app` folder is the **heart of the Next.js application**. It uses the **App Router** pattern (Next.js 13+), where the folder structure directly maps to URL routes.

### Key Concept:
```
app/
â”œâ”€â”€ page.tsx           â†’ Routes to: /
â”œâ”€â”€ layout.tsx         â†’ Wraps ALL pages
â”œâ”€â”€ game/
â”‚   â””â”€â”€ page.tsx       â†’ Routes to: /game
â””â”€â”€ auth/
    â””â”€â”€ page.tsx       â†’ Routes to: /auth
```

### Why This Matters:
- **File-based routing**: No need to manually configure routes
- **Automatic code splitting**: Each page loads only what it needs
- **Nested layouts**: Shared UI components wrap child pages
- **Server & Client components**: Mix server-side and client-side rendering

---

## ğŸ“ Folder Structure

```
app/
â”œâ”€â”€ layout.tsx              â† Root layout (wraps entire app)
â”œâ”€â”€ page.tsx                â† Landing page (/)
â”œâ”€â”€ globals.css             â† Global styles
â”‚
â”œâ”€â”€ game/
â”‚   â””â”€â”€ page.tsx            â† Game page (/game) - CRITICAL
â”‚
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ page.tsx            â† Auth page (/auth)
â”‚   â””â”€â”€ callback/
â”‚       â””â”€â”€ page.tsx        â† OAuth callback (/auth/callback)
â”‚
â””â”€â”€ api/
    â””â”€â”€ verify-reactions/
        â””â”€â”€ route.ts        â† API endpoint (/api/verify-reactions)
```

---

## ğŸ—ºï¸ Routing Architecture

### Route Map:

| URL | File | Purpose | Critical? |
|-----|------|---------|-----------|
| `/` | `app/page.tsx` | Landing page with "Start Game" button | Medium |
| `/game` | `app/game/page.tsx` | **Main game interface** | **ğŸ”´ CRITICAL** |
| `/auth` | `app/auth/page.tsx` | Login/signup page | High |
| `/auth/callback` | `app/auth/callback/page.tsx` | OAuth redirect handler | High |
| `/api/verify-reactions` | `app/api/verify-reactions/route.ts` | API for reaction validation | Medium |

---

## ğŸ“„ File-by-File Documentation

### 1. `app/layout.tsx` - Root Layout

**Purpose**: Wraps the ENTIRE application. Defines HTML structure and global metadata.

**Code**:
```typescript
import type { Metadata } from "next";
import "./globals.css";

export const metadata: Metadata = {
    title: "Kimia App",
    description: "Generated by create next app",
};

export default function RootLayout({
    children,
}: Readonly<{
    children: React.ReactNode;
}>) {
    return (
        <html lang="en" suppressHydrationWarning>
            <body>{children}</body>
        </html>
    );
}
```

**Key Points**:
- **`suppressHydrationWarning`**: Prevents React hydration warnings (common with Next.js)
- **`children`**: Placeholder for all page content
- **`metadata`**: Sets browser tab title and meta description
- **Global CSS**: Imported here, applies to ALL pages

**Critical Level**: ğŸŸ¡ Medium
- **Why**: Rarely needs changes, but breaking it breaks the entire app
- **When to Edit**: Changing app title, adding global fonts, or meta tags

---

### 2. `app/page.tsx` - Landing Page

**Purpose**: The first page users see. Shows game title and "Start Game" button.

**Code**:
```typescript
import Link from "next/link";
import { ArrowRight, Atom } from "lucide-react";

export default function Home() {
    return (
        <main className="flex min-h-screen flex-col items-center justify-center p-24 bg-slate-950 relative overflow-hidden">
            {/* Radial gradient background */}
            <div className="absolute inset-0 bg-[radial-gradient(...)] ..." />

            <div className="z-10 text-center space-y-8 max-w-2xl">
                {/* Animated atom icon */}
                <div className="flex justify-center mb-4">
                    <div className="p-4 bg-blue-600/20 rounded-full ...">
                        <Atom className="w-16 h-16 text-blue-400 animate-spin-slow" 
                              style={{ animationDuration: '10s' }} />
                    </div>
                </div>

                {/* Title */}
                <h1 className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-br from-white to-slate-500 ...">
                    KIMIA TCG
                </h1>

                {/* Description */}
                <p className="text-xl text-slate-400 leading-relaxed">
                    Mainkan permainan kad perdagangan kimia yang epik!
                    Sintesis sebatian, urus tenaga dan jisim, dan lawan rakan anda dalam masa nyata.
                </p>

                {/* Start button */}
                <div className="flex gap-4 justify-center pt-4">
                    <Link href="/game" className="group relative px-8 py-4 bg-blue-600 ...">
                        Mula Permainan
                        <ArrowRight className="ml-2 w-5 h-5 group-hover:translate-x-1 ..." />
                    </Link>
                </div>
            </div>

            {/* Version footer */}
            <div className="absolute bottom-8 text-slate-600 text-sm">
                Versi 2.0 (Supabase Realtime)
            </div>
        </main>
    );
}
```

**Key Features**:
1. **Animated Atom Icon**: Spins slowly (10s per rotation)
2. **Gradient Text**: Title uses gradient from white to slate
3. **Radial Background**: Creates depth with gradient overlay
4. **Next.js Link**: Uses `<Link>` for client-side navigation (faster than `<a>`)
5. **Hover Effects**: Button scales and glows on hover

**Critical Level**: ğŸŸ¢ Low
- **Why**: Purely cosmetic, doesn't affect game logic
- **When to Edit**: Changing branding, adding features to landing page

---

### 3. `app/game/page.tsx` - Game Page ğŸ”´ **CRITICAL**

**Purpose**: The MAIN game page. Renders the entire game interface.

**Code**:
```typescript
import GameInterface from '@/components/game/GameInterface';

export const metadata = {
    title: 'Kimia TCG - Play',
    description: 'Tactical Chemistry Game',
};

export default function GamePage() {
    return <GameInterface />;
}
```

**Why This is CRITICAL**:
1. **Single Point of Entry**: ALL game logic flows through `GameInterface`
2. **Routing Target**: The `/game` URL is where players spend 99% of their time
3. **Component Import**: Connects to the massive `GameInterface.tsx` component

**Key Points**:
- **Simple Wrapper**: This file is intentionally minimal
- **Metadata**: Sets browser tab title to "Kimia TCG - Play"
- **`@/` Alias**: Shorthand for project root (configured in `tsconfig.json`)

**Critical Level**: ğŸ”´ **MAXIMUM**
- **Why**: Breaking this breaks the ENTIRE game
- **When to Edit**: Almost NEVER (unless changing component name)
- **âš ï¸ WARNING**: Do NOT delete or rename without updating imports

**Dependencies**:
- Requires: `components/game/GameInterface.tsx` (the actual game)
- Used by: Next.js router when user navigates to `/game`

---

### 4. `app/auth/page.tsx` - Authentication Page

**Purpose**: Login and signup page for player accounts.

**Code** (Simplified):
```typescript
import AuthForm from '@/components/AuthForm';

export default function AuthPage() {
    return (
        <div className="min-h-screen bg-slate-950 flex items-center justify-center">
            <AuthForm />
        </div>
    );
}
```

**Key Features**:
- **Centered Layout**: Vertically and horizontally centers the auth form
- **Dark Background**: Matches game aesthetic
- **Component Delegation**: Actual form logic in `AuthForm.tsx`

**Critical Level**: ğŸŸ¡ Medium
- **Why**: Required for multiplayer, but game works without it (guest mode)
- **When to Edit**: Changing auth UI layout or adding OAuth providers

---

### 5. `app/auth/callback/page.tsx` - OAuth Callback Handler

**Purpose**: Handles redirect after OAuth login (e.g., Google, GitHub).

**How OAuth Works**:
```
1. User clicks "Login with Google"
2. Redirected to Google's login page
3. User logs in
4. Google redirects back to: /auth/callback?code=ABC123
5. This page exchanges code for session token
6. User is logged in and redirected to /game
```

**Critical Level**: ğŸŸ¡ Medium
- **Why**: Essential for OAuth, but not needed for email/password login
- **When to Edit**: Adding new OAuth providers or changing redirect logic

---

### 6. `app/api/verify-reactions/route.ts` - API Endpoint

**Purpose**: Server-side API for validating chemical reactions.

**Why Server-Side?**
- **Security**: Prevents cheating (client can't fake reactions)
- **Performance**: Heavy calculations done on server
- **Consistency**: Single source of truth for reaction rules

**Critical Level**: ğŸŸ¢ Low (if using client-side validation)
- **Why**: GitHub version might use client-side validation instead
- **When to Edit**: Implementing server-side anti-cheat

---

## ğŸ”´ Critical Files to Preserve

### **MUST KEEP** (Breaking these breaks the game):

1. **`app/game/page.tsx`** ğŸ”´ğŸ”´ğŸ”´
   - **Why**: Entry point to entire game
   - **Impact if deleted**: Game becomes inaccessible
   - **Backup**: Always keep a copy before editing

2. **`app/layout.tsx`** ğŸ”´ğŸ”´
   - **Why**: Wraps entire app
   - **Impact if deleted**: App won't render at all
   - **Backup**: Keep original version

### **SHOULD KEEP** (Breaking these breaks features):

3. **`app/auth/page.tsx`** ğŸŸ¡
   - **Why**: Required for multiplayer
   - **Impact if deleted**: Can't login (guest mode still works)

4. **`app/auth/callback/page.tsx`** ğŸŸ¡
   - **Why**: Required for OAuth
   - **Impact if deleted**: OAuth login fails

### **NICE TO HAVE** (Cosmetic):

5. **`app/page.tsx`** ğŸŸ¢
   - **Why**: Landing page
   - **Impact if deleted**: Can still access `/game` directly

---

## ğŸš€ Future Development Guidelines

### Adding New Pages:

**Example**: Adding a `/leaderboard` page

1. Create folder: `app/leaderboard/`
2. Create file: `app/leaderboard/page.tsx`
3. Add component:
```typescript
export default function LeaderboardPage() {
    return <div>Leaderboard Content</div>;
}
```
4. Link from menu:
```typescript
<Link href="/leaderboard">View Leaderboard</Link>
```

### Adding New API Endpoints:

**Example**: Adding `/api/save-game` endpoint

1. Create folder: `app/api/save-game/`
2. Create file: `app/api/save-game/route.ts`
3. Add handler:
```typescript
export async function POST(request: Request) {
    const data = await request.json();
    // Save game logic
    return Response.json({ success: true });
}
```

### Best Practices:

1. **Keep `page.tsx` Simple**: Delegate logic to components
2. **Use Metadata**: Always set page title and description
3. **Consistent Styling**: Match existing dark theme
4. **Error Boundaries**: Wrap pages in error handlers
5. **Loading States**: Add `loading.tsx` for better UX

---

## ğŸ“Š Dependency Graph

```
app/layout.tsx (Root)
    â†“
    â”œâ”€â”€ app/page.tsx (Landing)
    â”‚   â””â”€â”€ Links to â†’ app/game/page.tsx
    â”‚
    â”œâ”€â”€ app/game/page.tsx (CRITICAL)
    â”‚   â””â”€â”€ Renders â†’ components/game/GameInterface.tsx
    â”‚
    â””â”€â”€ app/auth/page.tsx (Auth)
        â”œâ”€â”€ Renders â†’ components/AuthForm.tsx
        â””â”€â”€ Redirects to â†’ app/auth/callback/page.tsx
```

---

## âš ï¸ Common Mistakes to Avoid

1. **Deleting `app/game/page.tsx`**: Game becomes inaccessible
2. **Renaming without updating imports**: Breaks component references
3. **Removing `layout.tsx`**: Entire app fails to render
4. **Hardcoding URLs**: Use `<Link>` instead of `<a>` for internal links
5. **Forgetting metadata**: Pages won't have proper titles

---

## ğŸ” Debugging Tips

### Page Not Loading?
1. Check file is named `page.tsx` (not `Page.tsx` or `index.tsx`)
2. Verify folder structure matches URL
3. Check for TypeScript errors in terminal
4. Ensure component is exported as `default`

### Routing Not Working?
1. Restart dev server (`npm run dev`)
2. Clear `.next` cache folder
3. Check for conflicting routes
4. Verify `next.config.js` is correct

---

## ğŸ“š Related Documentation

- [GameInterface Component](../components/GAME_INTERFACE.md) - The actual game logic
- [Lib Services](../lib/README.md) - Core game services
- [Next.js App Router](https://nextjs.org/docs/app) - Official Next.js docs

---

**Remember**: The `app` folder is the **skeleton** of the application. The `components` and `lib` folders are the **muscles and brain**. Keep this skeleton intact!
